/*! angular-leaflet-directive 01-08-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log","$parse","$rootScope",function(a,b,c,d){var e={maxZoom:14,minZoom:1,doubleClickZoom:!0,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:"Tiles &copy; Open Street Maps"},icon:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon@2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"}},f='Add testing="testing" to <leaflet> tag to inspect this object';return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",defaults:"=defaults",paths:"=paths",tiles:"=tiles",events:"=events"},template:'<div class="angular-leaflet-map"></div>',link:function(a,g,h){function i(){if("object"!=typeof a.events)return!1;for(var b in a.events)z.on(b,a.events[b])}function j(){var b,c;if(a.leaflet.tileLayer=h.defaults&&a.defaults&&a.defaults.tileLayer?a.defaults.tileLayer:e.tileLayer,a.defaults&&a.defaults.tileLayerOptions)for(c in a.defaults.tileLayerOptions)e.tileLayerOptions[c]=a.defaults.tileLayerOptions[c];if(h.tiles){if(a.tiles&&a.tiles.url&&(a.leaflet.tileLayer=a.tiles.url),a.tiles&&a.tiles.options)for(c in a.tiles.options)e.tileLayerOptions[c]=a.tiles.options[c];a.$watch("tiles.url",function(a){a&&b.setUrl(a)})}b=L.tileLayer(a.leaflet.tileLayer,e.tileLayerOptions),b.addTo(z),a.leaflet.tileLayerObj=h.testing?b:f}function k(){if(a.legend)if(a.legend.colors&&a.legend.labels&&a.legend.colors.length==a.legend.labels.length){var c=a.legend.position||"bottomright",d=L.control({position:c});d.onAdd=function(){for(var b=L.DomUtil.create("div","info legend"),c=0;c<a.legend.colors.length;c++)b.innerHTML+='<i style="background:'+a.legend.colors[c]+'"></i> '+a.legend.labels[c]+"<br />";return b},d.addTo(z)}else b.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}function l(){a.maxBounds&&a.maxBounds.southWest&&a.maxBounds.southWest.lat&&a.maxBounds.southWest.lng&&a.maxBounds.northEast&&a.maxBounds.northEast.lat&&a.maxBounds.northEast.lng&&(z.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.maxBounds.southWest.lat,a.maxBounds.southWest.lng),new L.LatLng(a.maxBounds.northEast.lat,a.maxBounds.northEast.lng))),a.$watch("maxBounds",function(a){a.southWest&&a.northEast&&a.southWest.lat&&a.southWest.lng&&a.northEast.lat&&a.northEast.lng&&z.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.southWest.lat,a.southWest.lng),new L.LatLng(a.northEast.lat,a.northEast.lng)))}))}function m(a){if(a){var b=a.southWest,c=a.northEast;if(b&&c&&b.lat&&b.lng&&c.lat&&c.lng){var d=new L.LatLng(b.lat,b.lng),e=new L.LatLng(c.lat,c.lng);z.fitBounds(new L.LatLngBounds(d,e))}}}function n(){a.bounds&&a.$watch("bounds",function(a){m(a)})}function o(){a.$watch("center",function(c){return c?(void 0!==c.lat&&void 0!==c.lng&&void 0!==c.zoom?z.setView([c.lat,c.lng],c.zoom,{reset:!0}):c.autoDiscover===!0&&z.locate({setView:!0,maxZoom:a.leaflet.maxZoom}),void 0):(b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),void 0)},!0),z.on("dragend",function(){a.safeApply(function(a){y.lat.assign(a,z.getCenter().lat),y.lng.assign(a,z.getCenter().lng)})}),z.on("zoomend",function(){angular.isUndefined(a.center)&&b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),(angular.isUndefined(a.center)||a.center.zoom!==z.getZoom())&&a.safeApply(function(a){y.zoom.assign(a,z.getZoom()),y.lat.assign(a,z.getCenter().lat),y.lng.assign(a,z.getCenter().lng)})})}function p(){a.$watch("geojson",function(b){if(b&&b.hasOwnProperty("data"))var c=L.geoJson(a.geojson.data,{style:a.geojson.style,onEachFeature:function(d,e){e.on({mouseover:function(c){b.mouseover(c),a.safeApply(function(){b.selected=d})},mouseout:function(d){c.resetStyle(d.target),a.safeApply(function(){b.selected=void 0})}})}}).addTo(z)})}function q(){var b;a.marker&&(b=s("marker",a.marker,z),a.leaflet.marker=h.testing?b:f,b.on("click",function(){d.$apply(function(){d.$broadcast("leafletDirectiveMainMarkerClick")})}))}function r(){function b(a){return function(){d.$apply(function(){d.$broadcast("leafletDirectiveMarkersClick",a)})}}var c={};if(a.leaflet.markers=h.testing?c:f,a.markers){for(var e in a.markers)c[e]=s("markers."+e,a.markers[e],z),c[e].on("click",b(e));a.$watch("markers",function(a){for(var d in c)void 0===a[d]&&delete c[d];for(var e in a)void 0===c[e]&&(c[e]=s("markers."+e,a[e],z),c[e].on("click",b(e)))},!0)}}function s(b,c,d){var e=t(c);d.addLayer(e),c.focus===!0&&e.openPopup(),e.on("dragend",function(){a.safeApply(function(){c.lat=e.getLatLng().lat,c.lng=e.getLatLng().lng}),c.message&&e.openPopup()});var f=a.$watch(b,function(a,b){return a?(b&&(void 0!==a.draggable&&a.draggable!==b.draggable&&(a.draggable===!0?e.dragging.enable():e.dragging.disable()),void 0!==a.focus&&a.focus!==b.focus&&(a.focus===!0?e.openPopup():e.closePopup()),void 0!==a.message&&a.message!==b.message&&e.bindPopup(a),(a.lat!==b.lat||a.lng!==b.lng)&&e.setLatLng(new L.LatLng(a.lat,a.lng)),a.icon&&a.icon!==b.icon&&e.setIcon(a.icon)),void 0):(d.removeLayer(e),f(),void 0)},!0);return e}function t(a){var b=null;b=a.icon?a.icon:u();var c=new L.marker(a,{icon:b,draggable:a.draggable?!0:!1});return a.message&&c.bindPopup(a.message),c}function u(){return L.icon({iconUrl:e.icon.url,iconRetinaUrl:e.icon.retinaUrl,iconSize:e.icon.size,iconAnchor:e.icon.anchor,popupAnchor:e.icon.popup,shadowUrl:e.icon.shadow.url,shadowRetinaUrl:e.icon.shadow.retinaUrl,shadowSize:e.icon.shadow.size,shadowAnchor:e.icon.shadow.anchor})}function v(){var c={};if(a.leaflet.paths=h.testing?c:f,a.paths){b.warn("[AngularJS - Leaflet] Creating polylines and adding them to the map will break the directive's scope's inspection in AngularJS Batarang");for(var d in a.paths)c[d]=w(d,a.paths[d],z);a.$watch("paths",function(a){for(var b in a)void 0===c[b]&&(c[b]=w(b,a[b],z));for(var d in c)void 0===a[d]&&delete c[d]},!0)}}function w(b,c,d){var f=new L.Polyline([],{weight:e.path.weight,color:e.path.color,opacity:e.path.opacity});if(void 0!==c.latlngs){var g=x(c.latlngs);f.setLatLngs(g)}void 0!==c.weight&&f.setStyle({weight:c.weight}),void 0!==c.color&&f.setStyle({color:c.color}),void 0!==c.opacity&&f.setStyle({opacity:c.opacity}),d.addLayer(f);var h=a.$watch("paths."+b,function(a,b){if(!a)return d.removeLayer(f),h(),void 0;if(b){if(void 0!==a.latlngs&&a.latlngs!==b.latlngs){var c=x(a.latlngs);f.setLatLngs(c)}void 0!==a.weight&&a.weight!==b.weight&&f.setStyle({weight:a.weight}),void 0!==a.color&&a.color!==b.color&&f.setStyle({color:a.color}),void 0!==a.opacity&&a.opacity!==b.opacity&&f.setStyle({opacity:a.opacity})}},!0);return f}function x(a){var b=a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)});return b}var y={lat:c("center.lat"),lng:c("center.lng"),zoom:c("center.zoom")};h.width&&g.css("width",h.width),h.height&&g.css("height",h.height),a.leaflet={},a.leaflet.maxZoom=h.defaults&&a.defaults&&a.defaults.maxZoom?parseInt(a.defaults.maxZoom,10):e.maxZoom,a.leaflet.minZoom=h.defaults&&a.defaults&&a.defaults.minZoom?parseInt(a.defaults.minZoom,10):e.minZoom,a.leaflet.doubleClickZoom=h.defaults&&a.defaults&&"boolean"==typeof a.defaults.doubleClickZoom?a.defaults.doubleClickZoom:e.doubleClickZoom;var z=new L.Map(g[0],{maxZoom:a.leaflet.maxZoom,minZoom:a.leaflet.minZoom,doubleClickZoom:a.leaflet.doubleClickZoom});z.setView([0,0],1),a.leaflet.map=h.testing?z:f,j(),o(),l(),n(),q(),r(),v(),k(),i(),p(),a.$on("leafletDirectiveSetMap",function(a,b){var c=b.shift();z[c].apply(z,b)}),a.safeApply=function(b){var c=this.$root.$$phase;"$apply"==c||"$digest"==c?a.$eval(b):a.$apply(b)}}}}]);